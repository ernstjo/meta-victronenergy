From 45a9e8ead2ee4f7f3990e7d85d7d4b7b855f05d0 Mon Sep 17 00:00:00 2001
From: Jeroen Hofstee <jhofstee@victronenergy.com>
Date: Mon, 4 Mar 2024 17:00:24 +0100
Subject: [PATCH] make the wasm version work over https

---
 index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/index.html b/index.html
index 7423797..c693ea8 100644
--- a/index.html
+++ b/index.html
@@ -46,7 +46,7 @@
                 status.innerHTML = 'Loading...';
 
                 const instance = await qtLoad({
-                    arguments: ['--mqtt', 'ws://' + document.location.host + ':9001/'],
+                    arguments: ['--mqtt', (location.protocol === 'https:' ? 'wss://' + document.location.host + '/websocket-mqtt' : 'ws://' + document.location.host + ':9001/')],
                     qt: {
                         onLoaded: () => showUi(screen),
                         onExit: exitData =>
-- 
2.34.1

